{{ define "main" }}
    {{ $env := printf "<strong><span id='user'>%s@%s</span><span id='terminal'>:</span><span id='dir'>~/%s</span></strong><span id='terminal'>$</span>" .Site.Params.Terminal.userName .Site.Params.Terminal.pcName "" | safeHTML }}
    {{ $envWithDir := printf "<strong><span id='user'>%s@%s</span><span id='terminal'>:</span><span id='dir'>~/%s</span></strong><span id='terminal'>$</span>" .Site.Params.Terminal.userName .Site.Params.Terminal.pcName .Site.Params.Terminal.workDir | safeHTML }}

    {{ $cd := printf "<span id='terminal'>cd %s</span>" .Site.Params.Terminal.workDir | safeHTML }}
    {{ $cat := printf "<span id=terminal>cat %s</span>" .Site.Params.Terminal.profile | safeHTML }}

    {{ $description := "" }}
    {{ if eq (substr .Site.Params.Terminal.description -3 3) ".md" }}
        {{ $s := "" }}
        {{ with .Site.GetPage .Site.Params.Terminal.description }}
            <!-- replace the first  p tag with a br tag  -->
            {{ $s = replaceRE "</?p[^>]*>" "" .Content 1 }}
        {{ end }}
    {{ $description = printf "<span id='terminal'>%s</span>" $s | safeHTML}}
    {{ else }}
    {{ $limit := sub (len (findRE "\n" .Site.Params.Terminal.description)) 1 }}
    {{ $description = printf "<span id='terminal'>%s</span>" .Site.Params.Terminal.description }}
    {{ $description = replaceRE "\n" "<br>" $description $limit| safeHTML }}
    {{ end }}

    {{ $tree := "" }}
    {{ $tree1 := "" }}
    {{ $tree2 := "" }}
    {{ $leaf := "" }}
    {{ $leaf1 := "" }}
    {{ $leaf2 := "" }}
    {{ if .Site.Params.Tree.use }}
        {{ $tree = printf "<span id='terminal'>tree ./%s/</span>" .Site.Params.Tree.folderName | safeHTML}}
        {{ $leaf = printf "%s<strong><span id='dir'>./%s/</span></strong><br>" $leaf .Site.Params.Tree.folderName | safeHTML}}
        {{ range $index , $val := .Site.Params.Tree.files }}
            {{ $ac := index $val "lang" }}
            {{ $link := index $val "ele" }}

            {{ if reflect.IsSlice $link }}
                {{ if eq (add $index 1) (len $.Site.Params.Tree.files) }}
                    {{ $leaf = printf "<span id='terminal'>%s└── %s</span>" $leaf $ac | safeHTML}}
                {{ else }}
                    {{ $leaf = printf "<span id='terminal'>%s├── %s</span><br>" $leaf $ac | safeHTML}}
                {{ end }}
                {{ range $index1, $val1 := $link }}
                    {{ $ac1 := index $val1 "lang" }}
                    {{ if eq (add $index 1) (len $.Site.Params.Tree.files) }}
                        {{ if eq (add $index1 1) (len $link) }}
                            {{ $leaf = printf "<span id='terminal'>%s  └── %s</span>" $leaf $ac1 | safeHTML}}
                        {{ else }}
                            {{ $leaf = printf "<span id='terminal'>%s  ├── %s</span><br>" $leaf $ac1 | safeHTML}}
                        {{ end }}
                    {{ else }}
                        {{ if eq (add $index1 1) (len $link) }}
                            {{ $leaf = printf "<span id='terminal'>%s│ └── %s</span><br>" $leaf $ac1 | safeHTML}}
                        {{ else }}
                            {{ $leaf = printf "<span id='terminal'>%s│ ├── %s</span><br>" $leaf $ac1 | safeHTML}}
                        {{ end }}
                    {{ end }}
                {{ end }}
            {{ else }}
                <!-- pass link (i.e. http, https) and mailto -->
                
                {{ if eq (add $index 1) (len $.Site.Params.Tree.files) }}
                    {{ $leaf = printf "<span id='terminal'>%s└── %s</span>" $leaf $ac | safeHTML}}
                {{ else }}
                    {{ $leaf = printf "<span id='terminal'>%s├── %s</span><br>" $leaf $ac | safeHTML}}
                {{ end }}
            {{ end }}
        {{ end }}

        {{ $tree1 = printf "<span id='terminal'>tree ./%s/</span>" .Site.Params.Tree1.folderName | safeHTML}}
        {{ $leaf1 = printf "%s<strong><span id='dir'>./%s/</span></strong><br>" $leaf1 .Site.Params.Tree1.folderName | safeHTML}}
        {{ range $index, $val := .Site.Params.Tree1.files }}
            {{ $ac := index $val 0}}
            {{ $desc := index $val 1}}
            {{ $link := index $val 2}}

            <!-- pass link (i.e. http, https) and mailto -->
            {{ $l := $.Site.GetPage $link }}
            {{ if $l }}
                {{ $link = $l.Permalink}}
            {{ end }}
            
            {{ if eq (add $index 1) (len $.Site.Params.Tree1.files) }}
            {{ $leaf1 = printf "<span id='terminal'>%s└── <a href='%s'>%s</a>, %s</span>" $leaf1 $link $ac $desc | safeHTML}}
            {{ else }}
            {{ $leaf1 = printf "<span id='terminal'>%s├── <a href='%s'>%s</a>, %s</span><br>" $leaf1 $link $ac $desc | safeHTML}}
            {{ end }}
        {{ end }}

        {{ $tree2 = printf "<span id='terminal'>tree ./%s/</span>" .Site.Params.Tree2.folderName | safeHTML}}
        {{ $leaf2 = printf "%s<strong><span id='dir'>./%s/</span></strong><br>" $leaf2 .Site.Params.Tree2.folderName | safeHTML}}
        {{ range $index, $val := .Site.Params.Tree2.files }}
            {{ $ac := index $val 0}}
            {{ $link := index $val 1}}

            <!-- pass link (i.e. http, https) and mailto -->
            {{ $l := $.Site.GetPage $link }}
            {{ if $l }}
                {{ $link = $l.Permalink}}
            {{ end }}
            
            {{ if eq (add $index 1) (len $.Site.Params.Tree2.files) }}
            {{ $leaf2 = printf "<span id='terminal'>%s└── <a href='%s'>%s</a></span>" $leaf2 $link $ac | safeHTML}}
            {{ else }}
            {{ $leaf2 = printf "<span id='terminal'>%s├── <a href='%s'>%s</a></span><br>" $leaf2 $link $ac | safeHTML}}
            {{ end }}
        {{ end }}
    {{ end }}

    {{ $end := $env }}

    {{ $payload := delimit (slice $cd $cat $description $tree $leaf $tree1 $leaf1 $tree2 $leaf2 $end) "" }}

    {{ $ps1Delay := $.Site.Params.Terminal.ps1Delay }}
    {{ $stdoutDelay :=  $.Site.Params.Terminal.stdoutDelay }}
    {{ $commandDelay := $.Site.Params.Terminal.commandDelay }}

    {{ partial "partials/typeIndex.html" (dict "context" . "env" $env "cd" $cd "envWithDir" $envWithDir "cat" $cat "description" $description "tree" $tree "tree1" $tree1 "tree2" $tree2 "leaf" $leaf "leaf1" $leaf1 "leaf2" $leaf2 "ps1delay" $ps1Delay "stdoutdelay" $stdoutDelay "commanddelay" $commandDelay ) }}

{{ end }}
